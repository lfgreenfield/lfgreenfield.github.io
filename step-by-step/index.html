<!DOCTYPE html>
<html>

<head>
    <meta charset=utf-8 />
    <title>Step-By-Step</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src="l.control.geosearch.js"></script>
    <script src="l.geosearch.provider.esri.js"></script>
    <script src="leaflet.awesome-markers.js"></script>
    <script src="ServiceDatabase.js"></script>
    
    <link rel="stylesheet" href="normalize.css" />
    <link rel="stylesheet" href="l.geosearch.css" />    
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
    <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="http://code.ionicframework.com/ionicons/1.5.2/css/ionicons.min.css">
    <link rel="stylesheet" href="leaflet.awesome-markers.css">
    
    <link href='http://fonts.googleapis.com/css?family=Ubuntu+Condensed' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Ubuntu:300,400' rel='stylesheet' type='text/css'>
   
    

    <style>
        body {
            margin: 0;
            padding: 0;
        }
        header {
            position: relative;
            height: 110px;
            width: 100%;
            background: #302725 url('images/bg_header_pattern.png');
            border-bottom: 6px solid #d48983;
        }
        header img {
            margin: 10px 0 0 15px   
        }
        h1 {
            position: absolute;
            z-index: 100;
            bottom: 15px;
            left: 30px;
            padding: 8px 15px;
            margin: 0;
            color: whitesmoke;
            font-size: 1.5em;
            border-radius: 5px
        }     
        #map {
            position: absolute;
            z-index: 100;
            width: 100%;
            top: 116px;
            bottom: 0;
        }    
        .leaflet-control-layers {
            font-family: "Ubuntu Condensed";
            padding: 6px 8px;
            color: #f4f4f4;
            background: #302725 url('images/bg_header_pattern.png');
            box-shadow: none;
            border-radius: 3px;
            width: 260px;
        }
        .leaflet-control-layers span {
            margin-left: 8px;
            text-indent: -8px;
        }
        .leaflet-container {
            font-size: 14px;
        }
        leaflet-top .leaflet-control {
            margin-top: 0;
        }
        leaflet-right. leaflet-control {
            margin-right: 0;
            float: none;
        }
        .leaflet-control {
            position: relative;
            top: 0px;
            left: 0px;
            bottom: 0;
            z-index: 7;
            pointer-events: auto;
        }
        .info {
            font-family: "Ubuntu";
            padding: 6px 8px;
            font-size: 1em;
            color: #f4f4f4;
            background: #302725 url('images/bg_header_pattern.png');
            border-radius: 3px;
            max-width: 260px;
            position: absolute;
            z-index: 200;
            word-wrap: break-word;
        }
        .info h3 {
            font-size: 1.1em;
            font-weight: 400; 
            line-height: 1.2em;
            margin: 4px 0 10px;
            padding: 0;
        }
        .info ul {
            padding-left: 0;
            list-style-type: none;
        }
        .info li {
            margin: 0 0 6px 0;
            font-size: .9em;
            font-weight: 300;
        }
        .leaflet-control-geosearch {
            position: absolute;
            right: 20px;
            bottom: 10px;
            width: 264px;
        }
        .leaflet-control-geosearch input {
            width: 96%; 
            padding: 5px 8px;
            background: #302725;
            color: #a9a9a9;
        }
      
    </style>
    
</head>

<body>  

    <header>
        <a href="http://sbs.cornettims.com/"><img src ="SBSLogo-sm.png" alt="LOGO" class='logo'></a>
    </header>

    <div id='map'></div>
    <div class='info'></div>

    <script>
        var options = {
            center: [38.0400,-84.4650],
            zoom: 12
        }
       
        var map = L.map('map', options);
        
        var tiles = L.tileLayer('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
	       attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        });
        
        map.addLayer(tiles); 
        
        new L.Control.GeoSearch({
            provider: new L.GeoSearch.Provider.Esri(),
            position: 'topright',
            zoomLevel: 15
        }).addTo(map);
        
        
        var searchbox = $('.leaflet-control-geosearch').detach().removeClass('leaflet-control').appendTo('header');
        
                                                                                       
        var layerInfo = {
            abuseSupport: {name: "Abuse Counseling and Support", color: 'red'},
            residentialAbuseHelp: {name: "Residential Substance Abuse Help", color: 'blue'},
            outpatientAbuseHelp: {name: "Outpatient Substance Abuse Assessment/Treatment/Support", color: 'purple'},
            emergencyShelters: {name: "Emergency Shelters", color: 'orange'},
            indigentHealthcare: {name: "Indigent Healthcare", color: 'lightgreen'},
            mentalHealth: {name: "Mental Health Assessment\/Counseling\/Support Groups", color: 'darkred'},
            clothfoodhousing: {name: "Clothing, Food, Housing, Financial Aid", color: 'green'},
            pregnancy: {name: "Pregnancy and Parenting", color: 'indigo'},
            education: {name: "Education", color: 'pink'},
            childcare: {name: "Childcare", color: 'beige'},
            employment: {name: "Employment", color: 'cadetblue'},
            addtlResources: {name: "Additional Resources", color: 'lightgray'}        
        }
        
        var geoJsonLayers = {}; 
               
        for (var layer in layerInfo) {
           geoJsonLayers[layer] = L.geoJson(serviceDatabase, {       
            
                pointToLayer: function(feature, latlng) {
                    
//                    var categoryMarker = L.AwesomeMarkers.icon({
//                        markerColor: layerInfo[layer].color,
//                    });
//                    
//                    return L.marker (latlng, {icon: categoryMarker}); 
                    
                    return L.circleMarker(latlng, {
                        stroke: false,
                        fillColor: layerInfo[layer].color,
                        fillOpacity: 1,
                        radius: 8
                    });
                    
                },
                filter: function(feature) {
                   
                    if (feature.properties.ServiceCat == layerInfo[layer].name) {
                        return feature;
                        
                    }
                },
                onEachFeature: function(feature, layer) {
                    var props = feature.properties;
                    var content = "<b>"+props.ServiceNam+"</b><br>"+props.Address+" "+props.City+", "+props.State+" "+props.ZipCode+"<br>";
                
                    //layer.bindPopup(content);
                    
                    layer.on('mouseover', function(e) {
                        $(".info").show();
                        updateInfo(props);
                    });
                    layer.on('mouseout', function(){
                        $(".info").hide(); 
                    });
                        
                    },       
            
          }).addTo(map); 
           
        }
        
        var categoryLayers = {
            "<font color='red'>Abuse Counseling & Support</font>": geoJsonLayers.abuseSupport,
            "<font color='blue'>Residential Substance Abuse Help</font>": geoJsonLayers.residentialAbuseHelp,
            "<font color='purple'>Outpatient Substance Abuse Treatment & Support</font>": geoJsonLayers.outpatientAbuseHelp,
            "<font color='orange'>Emergency Shelters</font>": geoJsonLayers.emergencyShelters,
            "<font color='lightgreen'>Indigent Healthcare</font>": geoJsonLayers.indigentHealthcare,
            "<font color='darkred'>Mental Health Assessment/Counseling/Support Groups</font>": geoJsonLayers.mentalHealth,
            "<font color='green'>Clothing, Food, Housing, Finance Aid</font>": geoJsonLayers.clothfoodhousing,
            "<font color='indigo'>Pregnancy and Parenting</font>": geoJsonLayers.pregnancy,
            "<font color='pink'>Education</font>": geoJsonLayers.education,
            "<font color='beige'>Childcare</font>": geoJsonLayers.childcare,
            "<font color='cadetblue'>Employment</font>": geoJsonLayers.employment,
            "<font color='lightgrey'>Additional Resources</font>": geoJsonLayers.addtlResources
          
        }        
        
        L.control.layers(null, categoryLayers, {collapsed:false}).addTo(map);
        
        
        $(".leaflet-control-layers").prepend('<label><input id="show-all" type="checkbox" class="leaflet-control-layers-selector" checked=""><span>SHOW all services</span></label><label><input id="hide-all" type="checkbox" class="leaflet-control-layers-selector"><span>HIDE all services</span></label><hr>');
        
        $("#show-all").change(function(e){
            if(!this.checked){
             // is now unchecked
                for(var layer in geoJsonLayers) {
                    map.removeLayer(geoJsonLayers[layer]);   
                }
                $(".leaflet-control-layers input").prop('checked', false);
                $("#hide-all").prop('checked', true);
             
            } else {
              // is now checked
                for(var layer in geoJsonLayers) {
                    map.addLayer(geoJsonLayers[layer]);   
                }
                $(".leaflet-control-layers input").prop('checked', true);
                $("#hide-all").prop('checked', false);
                
            }
        });
        
        $("#hide-all").change(function(e){
            if(!this.checked){
             // is now unchecked
                for(var layer in geoJsonLayers) {
                    map.addLayer(geoJsonLayers[layer]);   
                }
                $(".leaflet-control-layers input").prop('checked', true);
                $("#show-all").prop('checked', true);
                $("#hide-all").prop('checked', false);
             
            } else {
              // is now checked
                for(var layer in geoJsonLayers) {
                    map.removeLayer(geoJsonLayers[layer]);   
                }
                $(".leaflet-control-layers input").prop('checked', false);
                $("#hide-all").prop('checked',true);
                
            }
        });
        
//        
//        var info = L.control();
//        
//        info.onAdd = function (map) {
//            var div = L.DomUtil.create('div', 'info');           
//            return div;
//        };
        
        
        function updateInfo(props) {
           
           var html = "<h3>"+props.ServiceNam+"</h3><ul>"+
                    "<li>"+props.Address+" "+props.City+", "+props.State+" "+
               props.ZipCode+"</li>"+"<li>";
            
            if(props.PrimaryPho != null){
               html+= "(p):"+props.PrimaryPho+"</li>";
            }
            if(props.SecondaryP != null){
                html+= "<li>(s): <b>"+props.SecondaryP+"</li>";
            }
            if(props.Website != null){
                html += "<li>"+props.Website+"</li>"
            }
            
            html+= "<li>Category: "+props.ServiceCat+"</li>";

           $(".info").html(html);
               
        };
        
       // info.addTo(map);
        
        // hide the info box on initialize
        $(".info").hide();
        
        $(document).mousemove(function(e){
            $(".info").css({"left": e.pageX + 8, "top": e.pageY - $(".info").height() - 8}); 
            if($(".info").offset().top < 4) {
                $(".info").css({"top": e.pageY + 8});
            }
        });
        
                                    
       </script>
    
</body>

</html>